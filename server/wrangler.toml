name = "atrarium"
main = "./src/index.ts"
compatibility_date = "2024-10-22"
compatibility_flags = ["nodejs_compat"]

# Durable Objects Bindings (006-pds-1-db)
[durable_objects]
bindings = [
  { name = "COMMUNITY_FEED", class_name = "CommunityFeedGenerator" },
  { name = "FIREHOSE_RECEIVER", class_name = "FirehoseReceiver" }
]

# Durable Objects Migrations
[[migrations]]
tag = "v1"
new_classes = ["CommunityFeedGenerator", "FirehoseReceiver"]

# Environment Variables
[vars]
ENVIRONMENT = "development"

# Cron Triggers (for post deletion sync)
[triggers]
crons = ["0 */12 * * *"]  # Every 12 hours

# Build Configuration
[build]
command = "npm run typecheck"

# Upload Rules
[[rules]]
globs = ["**/*.{ts,js,json}"]
type = "ESModule"

# Cloudflare Queues (006-pds-1-db)
[[queues.producers]]
binding = "FIREHOSE_EVENTS"
queue = "firehose-events"

[[queues.consumers]]
queue = "firehose-events"
max_batch_size = 100
max_batch_timeout = 5
max_retries = 3
dead_letter_queue = "firehose-dlq"
